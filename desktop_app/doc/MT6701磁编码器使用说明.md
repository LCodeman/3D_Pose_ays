# MT6701 磁编码器使用说明

## 1. 传感器简介

MT6701是一款14位高精度磁旋转编码器，具有以下特点：
- **分辨率**: 14位（16384个位置）
- **角度精度**: 0.022° (360°/16384)
- **通信接口**: I2C、ABZ、PWM
- **I2C地址**: 0x06（默认7位地址）
- **工作电压**: 3.3V - 5V

## 2. 磁铁安装要求 ⭐

### 2.1 磁铁规格

推荐使用以下规格的磁铁：

**选项1：径向充磁圆柱形磁铁（推荐）**
- 直径: 6mm
- 厚度: 2.5mm - 3mm
- 材料: 钕铁硼 (NdFeB) N35或以上
- 充磁方式: **径向充磁**（Radial magnetization）

**选项2：轴向充磁圆盘形磁铁**
- 直径: 4mm - 8mm
- 厚度: 2mm - 3mm
- 材料: 钕铁硼 (NdFeB) N35或以上
- 充磁方式: **轴向充磁**（Axial magnetization）

### 2.2 安装位置和距离

```
        旋转轴
          |
          |
    +-----+-----+
    |   磁铁    |  ← 径向充磁
    +-----+-----+
          |
          |  距离: 0.5mm - 3mm（推荐1-2mm）
          |
    ============
    | MT6701芯片 |
    ============
    |  PCB板   |
    +----------+
```

**关键参数：**
1. **垂直距离（气隙）**: 0.5mm - 3mm
   - 推荐距离: **1mm - 2mm**
   - 距离过近: 可能导致磁场饱和
   - 距离过远: 信号减弱，精度下降

2. **对中要求**:
   - 磁铁中心必须与MT6701芯片中心对齐
   - 径向偏差应小于0.5mm
   - 倾斜角度应小于5°

### 2.3 磁铁充磁方向

**径向充磁（推荐用于旋转编码）:**
```
     N
    ↑ ↑
  ← | | →  ← 磁力线方向
    ↓ ↓
     S
```
磁极从中心向外辐射，适合检测旋转角度。

**轴向充磁（备选方案）:**
```
    N极
  -------
  | 磁铁 |
  -------
    S极
     ↓
  MT6701
```
磁极沿厚度方向，N极或S极朝向传感器均可。

## 3. 硬件连接

### 3.1 引脚定义

| MT6701引脚 | ESP32-S3 | 说明 |
|-----------|---------|------|
| VDD | 3.3V/5V | 电源（支持3.3V或5V）|
| GND | GND | 地线 |
| SDA | GPIO 5 | I2C数据线 |
| SCL | GPIO 6 | I2C时钟线 |
| PWM | GPIO 7 | PWM输出（可选）|

### 3.2 接线示意图

```
ESP32-S3              MT6701
┌─────────┐          ┌─────────┐
│         │          │         │
│  GPIO 5 ├──────────┤ SDA     │
│  GPIO 6 ├──────────┤ SCL     │
│  GPIO 7 ├──────────┤ PWM     │
│         │          │         │
│   3.3V  ├──────────┤ VDD     │
│   GND   ├──────────┤ GND     │
│         │          │         │
└─────────┘          └─────────┘
```

## 4. 安装步骤

### 步骤1：固定MT6701模块
- 将MT6701模块固定在底座上
- 确保模块表面水平

### 步骤2：准备旋转轴
- 在旋转轴上安装磁铁
- 确保磁铁牢固固定（可用胶水）

### 步骤3：对齐和调整
1. 将旋转轴装配到位
2. 测量磁铁到传感器的距离（使用塞尺或游标卡尺）
3. 调整距离至1-2mm
4. 确保磁铁与传感器同心

### 步骤4：测试验证
1. 上传代码到ESP32
2. 打开串口监视器（115200波特率）
3. 观察角度读数是否正常
4. 手动旋转磁铁，检查角度变化是否平滑

## 5. 测试和校准

### 5.1 初次测试

连接ESP32后，串口会显示：
```
======================================
     MT6701 磁编码器初始化
======================================

【初始化步骤】
1. 配置I2C接口 (SDA=GPIO5, SCL=GPIO6)... ✓
2. 测试I2C通信... ✓
3. 读取初始角度... ✓ (123.45°)

✅ MT6701初始化成功！
磁编码器已就绪，开始角度采集...
```

### 5.2 检查角度读数

正常情况下，串口会显示：
```
========================================
📊 加速度 (g): X=0.001 Y=-0.002 Z=1.000
🔄 陀螺仪 (°/s): X=0.12 Y=-0.05 Z=0.00
🧭 角度 (°): 123.45 (原始: 5678/16383) ✓
🌡️  温度: 25.3 °C ✓
========================================
```

### 5.3 常见问题排查

**问题1：显示"⚠️ 无效"或角度为0**
- 检查磁铁是否安装
- 检查磁铁距离是否在0.5-3mm范围内
- 检查磁铁是否对中

**问题2：角度跳变或不稳定**
- 磁铁距离太远，增强磁场
- 磁铁未对中，重新调整
- 周围有强磁场干扰，远离干扰源

**问题3：I2C通信失败**
- 检查SDA、SCL接线
- 检查电源连接
- 确认I2C地址是否为0x06

## 6. Web界面查看

访问ESP32的IP地址，可在网页上实时查看：
- 加速度（X, Y, Z）
- 陀螺仪（X, Y, Z）
- **磁编码器角度**（0-360°）
- **原始角度值**（0-16383）
- 温度

## 7. 应用场景

- **电机角度检测**: 安装在电机轴上，实时监测转角
- **机械臂关节**: 检测关节旋转角度
- **云台控制**: 监测云台俯仰/偏航角度
- **舵机反馈**: 为舵机提供精确位置反馈
- **旋钮控制**: 无接触式旋钮编码器

## 8. 技术参数

| 参数 | 数值 |
|-----|------|
| 角度分辨率 | 14位 (0.022°) |
| 测量范围 | 0° - 360° (全周) |
| 刷新率 | 最高2kHz |
| I2C速度 | 最高400kHz |
| 工作温度 | -40°C ~ 125°C |
| 磁场强度要求 | 30mT - 70mT |

## 9. 注意事项 ⚠️

1. **磁铁质量**: 使用高质量钕铁硼磁铁，避免使用铁氧体磁铁
2. **距离控制**: 严格控制气隙在1-2mm，过近或过远都会影响精度
3. **对中精度**: 磁铁中心与传感器中心偏差应小于0.5mm
4. **避免磁干扰**: 远离电机、喇叭等强磁场源
5. **固定牢固**: 确保磁铁在高速旋转时不会脱落
6. **温度影响**: 高温会导致磁铁退磁，注意工作环境温度
7. **多圈计数**: MT6701只能检测单圈角度，需要额外逻辑实现多圈计数

## 10. 购买建议

**MT6701模块**: 淘宝/亚马逊搜索"MT6701磁编码器"
**磁铁**: 
- 搜索"6x3mm 径向充磁 钕铁硼磁铁"
- 或 "D6H3 径向磁铁 N35"
- 价格约￥1-5元/个

---

**更新日期**: 2025-10-22  
**固件版本**: v1.0  
**作者**: 3D姿态检测系统

